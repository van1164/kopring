---
icon: docker
---

# Docker Compose로 CPU·메모리 자원 관리하기

### 1. 문제 상황

초기에 Redis·뉴스 크롤러(IT·축구) 컨테이너를 단순히 docker-compose up -d 로 띄워 두었습니다. 자원 제한을 두지 않자 다음과 같은 문제가 반복됐다.



메모리 사용 폭주(OOMKill)

* 크롤러가 대량 수집하면서 파이썬 프로세스 메모리가 급증
  * 호스트 전체 메모리 부족 → EC2 뻗음.

***

### 2. 해결 과정

#### 2-1. 서비스별 리소스 정책 설계

| 서비스        | 예상 최대 메모리 | 예상 CPU 사용률 | 전략             |
| ---------- | --------- | ---------- | -------------- |
| Redis      | 256 MB    | 낮음         | 여유 메모리만 지정     |
| IT 크롤러     | 1 GB      | 0.5 core   | 메모리·CPU limit, |
| Soccer 크롤러 | 1 GB      | 0.5 core   | 동일 정책          |

#### 2-2. docker-compose.yml 핵심 설정

```yaml
deploy:  
  resources:    
  limits:      
  memory: 1G      # 메모리 상한      
  cpus: '0.5'     # 0.5 core    
  reservations:      
    memory: 512M    # 스케줄러 힌트      
    cpus: '0.25'
logging:  
  driver: "json-file"  
  options:    max-size: "10m"   # 10 MB 단위 로테이션    
  max-file: "3"     # 최대 3개 보관
pids_limit: 8192      # PID 폭주 방지
ulimits:  
  nproc: 65536        # 프로세스 수 하드 리밋

```



***

### 3. 결과

| 구분         | 개선 전          | 개선 후              |
| ---------- | ------------- | ----------------- |
| OOMKill 발생 | 주 3–4회        | 0회                |
| CPU 사용 피크  | 200% (2 core) | 50% (0.5 core 제한) |
| 평균 크롤 주기   | 10 분 ± 4 분    | 10 분 ± 30 초       |
| 로그 디스크 사용  | 6 GB/주        | 300 MB/주          |
| 서비스 다운     | 발생            | 미발생               |

* 안정성: 메모리·CPU 경합 제거로 호스트 전체 서비스가 안정화
* 가시성: docker stats 모니터링 결과 값이 예측가능해짐
* 운영 편의: 디스크·메모리 알람이 사라져 야간 장애 호출 감소

***

### 4. 결론 및 팁

1. **컨테이너의 CPU, 메모리 제한**

&#x20;      개발 단계부터 예상 메모리·CPU 예산을 설정해 limits를 걸면 운영 중 큰 사고를 예방할 수 있음.

2. **로그 로테이션 설정 필수**

&#x20;      json-file 기본값은 무제한 - 작은 max-size 로 자르고 max-file 제한을 두세요.

